<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ระบบรับเอกสาร RFA & RFI จากปากช่อง</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
    }
    input, select, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    .status-อนุมัติ {
      color: green;
      font-weight: bold;
    }
    .status-ไม่อนุมัติ {
      color: red;
      font-weight: bold;
    }
    .status-รอดำเนินการ {
      color: orange;
      font-weight: bold;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2 style="color: #2E7D32;">ระบบรับเอกสาร RFA & RFI จากปากช่อง</h2>

    <input type="text" id="docName" placeholder="ชื่อเอกสาร">
    <select id="docStatus" onchange="updateSelectColor(this)">
      <option value="รอดำเนินการ">รอดำเนินการ</option>
      <option value="อนุมัติ">อนุมัติ</option>
      <option value="ไม่อนุมัติ">ไม่อนุมัติ</option>
    </select>
    <input type="date" id="returnDate">
    <button onclick="addDocument()">เพิ่มเอกสาร</button>

    <table>
      <thead>
        <tr>
          <th>ชื่อเอกสาร</th>
          <th>สถานะ</th>
          <th>วันที่รับคืน</th>
          <th>การจัดการ</th>
        </tr>
      </thead>
      <tbody id="docTable"></tbody>
    </table>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyVKJBXCuoRhQJ7elXaLl63ERHCfQaBULHVSU5QWBC6ZMrH5jsKPfHz3vNyWq9fdL6bkw/exec';

    async function callApi(method, data = {}, id = '') {
      const fullUrl = method === 'DELETE' ? `${SCRIPT_URL}?id=${id}` : SCRIPT_URL;

      const options = {
        method,
        headers: { 'Content-Type': 'application/json' },
      };

      if (method !== 'GET' && method !== 'DELETE') {
        options.body = JSON.stringify(data);
      }

      const response = await fetch(fullUrl, options);
      return response.json();
    }

    async function loadDocuments() {
      const res = await callApi('GET');
      const table = document.getElementById('docTable');
      table.innerHTML = '';
      res.data.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td class="status-${item.status}">${item.status}</td>
          <td>${item.date}</td>
          <td>
            <button onclick="editDocument('${item.id}', '${item.name}', '${item.status}', '${item.date}')">แก้ไข</button>
            <button onclick="deleteDocument('${item.id}')">ลบ</button>
          </td>
        `;
        table.appendChild(tr);
      });
    }

    async function addDocument() {
      const name = document.getElementById('docName').value;
      const status = document.getElementById('docStatus').value;
      const date = document.getElementById('returnDate').value;
      if (!name || !date) return alert('กรุณากรอกข้อมูลให้ครบ');
      await callApi('POST', { name, status, date });
      loadDocuments();
      document.getElementById('docName').value = '';
      document.getElementById('returnDate').value = '';
    }

    async function editDocument(id, name, status, date) {
      const newName = prompt('แก้ไขชื่อเอกสาร', name);
      const newStatus = prompt('แก้ไขสถานะ (รอดำเนินการ/อนุมัติ/ไม่อนุมัติ)', status);
      const newDate = prompt('แก้ไขวันที่รับคืน', date);
      if (newName && newStatus && newDate) {
        await callApi('PUT', { id, name: newName, status: newStatus, date: newDate });
        loadDocuments();
      }
    }

    async function deleteDocument(id) {
      if (confirm('ยืนยันการลบเอกสารนี้?')) {
        await callApi('DELETE', {}, id);
        loadDocuments();
      }
    }

    function updateSelectColor(select) {
      select.style.color =
        select.value === 'อนุมัติ' ? 'green' :
        select.value === 'ไม่อนุมัติ' ? 'red' : 'orange';
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateSelectColor(document.getElementById('docStatus'));
      loadDocuments();
    });
  </script>
</body>
</html>
