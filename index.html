<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ RFA & RFI ‡∏à‡∏≤‡∏Å‡∏õ‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
    }
    h2 {
      text-align: center;
      color: #0056b3;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="date"],
    select {
      padding: 10px;
      margin: 8px 0;
      width: calc(100% - 22px); /* Account for padding and border */
      box-sizing: border-box;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    input[type="text"][readonly] {
        background-color: #e9e9e9;
        cursor: not-allowed;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
      width: auto;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0056b3;
    }
    button#cancelButton {
        background-color: #dc3545;
        margin-left: 10px;
    }
    button#cancelButton:hover {
        background-color: #c82333;
    }
    .search {
      margin-top: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-start;
    }
    .buttons input[type="file"] {
        width: auto;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #fff;
    }
    .buttons button {
        width: auto;
        flex-grow: 1; /* Allow buttons to grow */
        max-width: 200px; /* Max width for buttons */
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #e0e0e0;
      padding: 8px 12px;
      font-size: 14px;
      vertical-align: middle;
      text-align: center;
      white-space: nowrap; /* Prevent wrapping in table cells */
    }
    th {
      background-color: #e9ecef;
      font-weight: bold;
      color: #333;
    }
    tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    .action-btn {
      font-size: 12px;
      padding: 4px 8px;
      margin: 2px;
      border: 1px solid #aaa;
      border-radius: 3px;
      background-color: #f5f5f5;
      cursor: pointer;
      transition: background-color 0.2s ease;
      white-space: nowrap; /* Ensure button text stays on one line */
    }
    .action-btn:hover {
      background-color: #e0e0e0;
    }
    .action-container {
      display: flex;
      justify-content: center;
      gap: 5px;
      flex-wrap: nowrap;
    }
    .status-display {
      padding: 4px 8px;
      color: white;
      border-radius: 4px;
      display: inline-block;
      text-align: center;
      font-weight: bold;
      min-width: 80px; /* Ensure consistent width for status badges */
    }
    .status-‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ { background-color: #28a745; } /* Green */
    .status-‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å { background-color: #ffc107; color: black; } /* Yellow */
    .status-‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° { background-color: #fd7e14; color: black; } /* Orange */
    .status-‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ { background-color: #dc3545; } /* Red */
    .status-DONE { background-color: #007bff; } /* Blue */
    .duplicate-row { background-color: #ffe0e0; } /* Light red for duplicates */
  </style>
</head>
<body>

  <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ RFA & RFI ‡∏à‡∏≤‡∏Å‡∏õ‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á</h2>

  <label for="docName">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
  <input type="text" id="docName" placeholder="‡πÄ‡∏ä‡πà‡∏ô RFA-000001">

  <label for="docStatus">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
  <select id="docStatus">
    <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
    <option value="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</option>
    <option value="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</option>
    <option value="‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
    <option value="DONE">DONE</option>
  </select>

  <label for="docDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</label>
  <input type="date" id="docDate">

  <button onclick="addOrUpdateDocument()" id="submitButton">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</button>
  <button onclick="cancelUpdate()" id="cancelButton" style="display: none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>

  <div class="search">
    <label for="searchInput">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞..." oninput="renderTable()">
  </div>

  <div class="buttons">
    <input type="file" accept=".csv" onchange="importCSV(event)" id="csvFileInput">
    <button onclick="downloadCSV()">üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
    <button onclick="deleteSelected()">üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
  </div>

  <table>
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleAll(this)"></th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</th>
        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody id="docTable"></tbody>
  </table>

  <script>
    // ******** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ********
    const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbymBRP9rykedn_Nq7qS1Lg0htyu_kdzUmExFXqLV1goRZAU9cTe5kHEhdZJJbjr3ZUTJg/exec'; 
    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 'https://script.google.com/macros/s/AKfycby_XXXXXXXXXXXXXXX/exec';
    // ***********************************************************************************

    let documents = [];
    let editingDocOriginalName = null; // Stores the original name of the document being edited

    // Function to load data from Google Sheet
    function loadFromSheet() {
      fetch(SHEET_API_URL)
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.json();
        })
        .then(data => {
          // Map data from Google Sheet's header names to friendlier JS object keys
          documents = data.map(row => ({
            name: row["‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£"],
            status: row["‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"],
            date: row["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô"],
            isDuplicate: false // This will be checked client-side later if needed
          }));
          renderTable();
        })
        .catch(err => {
          alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apps Script");
          console.error("Failed to load data from sheet:", err);
        });
    }

    // Function to send data to Google Sheet (add, update, or delete)
    function sendToSheet(payload) {
      fetch(SHEET_API_URL, {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.text(); // Google Apps Script usually returns plain text for success/error messages
        })
        .then(data => {
          console.log("Response from sheet:", data);
          loadFromSheet(); // Reload data to reflect changes
          clearInputs();
          resetFormForAdd();
          document.getElementById('docName').focus(); // Focus on name input after action
          // Clear file input after import to allow re-importing same file
          document.getElementById('csvFileInput').value = '';
        })
        .catch(err => {
          alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ: ${payload.action} ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà`);
          console.error(`Failed to ${payload.action} data to sheet:`, err);
        });
    }

    // Renders (or re-renders) the table with current documents array
    function renderTable() {
      const tbody = document.getElementById("docTable");
      tbody.innerHTML = "";
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();

      const filteredDocs = documents.filter(doc =>
        doc.name.toLowerCase().includes(searchTerm) ||
        doc.status.toLowerCase().includes(searchTerm)
      );

      filteredDocs.forEach(doc => {
        const tr = document.createElement("tr");
        // Check for client-side duplicates only among currently displayed docs
        const currentDocNames = filteredDocs.map(d => d.name);
        const occurrences = currentDocNames.filter(name => name === doc.name).length;
        tr.className = (occurrences > 1) ? "duplicate-row" : "";
        
        tr.innerHTML = `
          <td><input type="checkbox" class="doc-checkbox" value="${doc.name}"></td>
          <td>${doc.name}</td>
          <td><span class="status-display status-${doc.status.replace(/\s/g, '')}">${doc.status}</span></td>
          <td>${doc.date}</td>
          <td>
            <div class="action-container">
              <button class="action-btn" onclick="editDocument('${doc.name.replace(/'/g, "\\'")}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="action-btn" onclick="confirmDelete('${doc.name.replace(/'/g, "\\'")}')">‡∏•‡∏ö</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
      updateSelectAllCheckbox(); // Update the header checkbox state
    }

    // Handles adding a new document or updating an existing one
    function addOrUpdateDocument() {
      const name = document.getElementById('docName').value.trim();
      const status = document.getElementById('docStatus').value;
      const date = document.getElementById('docDate').value;

      if (!name || !date) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô");
        return;
      }

      if (editingDocOriginalName) { // If editing an existing document
        // Check if the new name clashes with another existing document (excluding itself)
        const isNameTaken = documents.some(doc => doc.name === name && doc.name !== editingDocOriginalName);
        if (isNameTaken) {
          alert("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô");
          return;
        }
        sendToSheet({ action: 'update', originalName: editingDocOriginalName, name, status, date });
      } else { // Adding a new document
        const isDuplicate = documents.some(doc => doc.name === name);
        if (isDuplicate) {
          alert("‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô");
          return;
        }
        sendToSheet({ action: 'add', name, status, date });
      }
    }

    // Populates input fields for editing a document
    function editDocument(nameToEdit) {
      const docToEdit = documents.find(doc => doc.name === nameToEdit);
      if (docToEdit) {
        document.getElementById('docName').value = docToEdit.name;
        document.getElementById('docStatus').value = docToEdit.status;
        document.getElementById('docDate').value = docToEdit.date;
        editingDocOriginalName = docToEdit.name; // Store the original name for the update operation

        document.getElementById('submitButton').textContent = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£";
        document.getElementById('cancelButton').style.display = 'inline-block';
        document.getElementById('docName').readOnly = true; // Prevent changing name during edit to maintain identifier
      }
    }

    // Resets the form to "add new document" mode
    function cancelUpdate() {
      clearInputs();
      resetFormForAdd();
    }

    // Helper to reset form elements to default "add" state
    function resetFormForAdd() {
      document.getElementById('submitButton').textContent = "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£";
      document.getElementById('cancelButton').style.display = 'none';
      document.getElementById('docName').readOnly = false;
      editingDocOriginalName = null;
    }

    // Confirms and initiates deletion of a single document
    function confirmDelete(nameToDelete) {
        if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ "${nameToDelete}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
            sendToSheet({ action: 'delete', names: [nameToDelete] });
        }
    }

    // Handles deletion of multiple selected documents
    function deleteSelected() {
        const selectedCheckboxes = Array.from(document.querySelectorAll('.doc-checkbox:checked'));
        if (selectedCheckboxes.length === 0) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö");
            return;
        }

        const namesToDelete = selectedCheckboxes.map(checkbox => checkbox.value);

        if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${namesToDelete.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
            sendToSheet({ action: 'delete', names: namesToDelete });
        }
    }

    // Clears the input fields
    function clearInputs() {
      document.getElementById('docName').value = "";
      document.getElementById('docDate').value = "";
      document.getElementById('docStatus').selectedIndex = 0; // Reset to first option
      document.querySelector('th input[type="checkbox"]').checked = false; // Uncheck select all
    }

    // Toggles all checkboxes in the table
    function toggleAll(source) {
      const checkboxes = document.querySelectorAll('.doc-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.checked = source.checked;
      });
    }

    // Updates the state of the "select all" checkbox based on individual checkboxes
    function updateSelectAllCheckbox() {
      const allCheckboxes = document.querySelectorAll('.doc-checkbox');
      const checkedCheckboxes = document.querySelectorAll('.doc-checkbox:checked');
      const selectAllCheckbox = document.querySelector('th input[type="checkbox"]');

      if (allCheckboxes.length === 0) {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = false;
      } else if (checkedCheckboxes.length === allCheckboxes.length) {
        selectAllCheckbox.checked = true;
        selectAllCheckbox.indeterminate = false;
      } else if (checkedCheckboxes.length > 0) {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = true;
      } else {
        selectAllCheckbox.checked = false;
        selectAllCheckbox.indeterminate = false;
      }
    }

    // Event listener for individual checkboxes to update the "select all" state
    document.addEventListener('change', (event) => {
      if (event.target.classList.contains('doc-checkbox')) {
        updateSelectAllCheckbox();
      }
    });

    // Imports documents from a CSV file
    function importCSV(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const csv = e.target.result;
            const lines = csv.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            
            if (lines.length === 0) {
                alert("‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤");
                return;
            }

            // Assuming first row is headers if not skipped
            // If your CSV has headers and you want to skip them, uncomment the next line:
            // const headers = lines.shift().split(',').map(h => h.trim()); 

            const importedDocs = [];

            lines.forEach(line => {
                const parts = line.split(','); // Assuming comma-separated values
                if (parts.length >= 3) { // Ensure enough columns
                    const name = parts[0].trim();
                    const status = parts[1].trim();
                    const date = parts[2].trim();
                    // Basic validation for date format (YYYY-MM-DD for input type="date")
                    if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) {
                        console.warn(`Skipping row due to invalid date format: ${line}`);
                        return; // Skip this row if date format is not YYYY-MM-DD
                    }
                    importedDocs.push({ name, status, date });
                } else {
                    console.warn(`Skipping row due to insufficient columns: ${line}`);
                }
            });

            if (importedDocs.length === 0) {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô)");
                return;
            }
            
            // Send each imported document as an 'add' action
            // You might want to implement batch adding or more sophisticated duplicate handling here
            importedDocs.forEach(doc => {
                // Check if document with same name already exists to prevent explicit duplicates
                const isDuplicateOnImport = documents.some(existingDoc => existingDoc.name === doc.name);
                if (!isDuplicateOnImport) {
                    sendToSheet({ action: 'add', name: doc.name, status: doc.status, date: doc.date });
                } else {
                    console.warn(`Skipping import of duplicate document name: ${doc.name}`);
                }
            });
            alert(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${importedDocs.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏ñ‡∏π‡∏Å‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ)`);
            event.target.value = ''; // Clear the file input
        };
        reader.readAsText(file);
    }

    // Downloads current documents as a CSV file
    function downloadCSV() {
        let csvContent = "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô\n"; // Headers in Thai
        documents.forEach(doc => {
            // Escape commas within data if necessary (e.g., wrap in quotes)
            const escapedName = `"${doc.name.replace(/"/g, '""')}"`;
            const escapedStatus = `"${doc.status.replace(/"/g, '""')}"`;
            const escapedDate = `"${doc.date.replace(/"/g, '""')}"`;
            csvContent += `${escapedName},${escapedStatus},${escapedDate}\n`;
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;\uFEFF' }); // Added BOM for proper UTF-8 in Excel
        const link = document.createElement('a');
        if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'rfa_rfi_documents.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    }

    // Initial load of documents when the page is ready
    document.addEventListener('DOMContentLoaded', () => {
      loadFromSheet();
    });
  </script>
</body>
</html>
